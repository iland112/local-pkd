global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s
    retries 3

# HAProxy Stats (웹 UI)
frontend stats
    mode http
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE

# LDAP Frontend (클라이언트 연결 포인트)
frontend ldap_frontend
    bind *:389
    default_backend ldap_backend

# LDAP Backend (OpenLDAP MMR 노드들)
backend ldap_backend
    balance roundrobin
    option tcp-check

    # 헬스체크: LDAP anonymous bind 테스트
    # OpenLDAP이 응답하는지 확인
    tcp-check connect

    # OpenLDAP 노드들 (osixia/openldap uses port 389)
    server openldap1 openldap1:389 check inter 5s fall 3 rise 2
    server openldap2 openldap2:389 check inter 5s fall 3 rise 2
