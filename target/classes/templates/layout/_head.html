<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head-content">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${pageTitle} ?: 'ICAO PKD Download File Manager'">ICAO PKD Download File Manager</title>
    <link rel="stylesheet" th:href="@{/css/application.css}" />
    <link rel="stylesheet" th:href="@{/css/dashboard.css}" />
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.min.css}" />

    <!-- Alpine.js Core -->
    <script
      type="text/javascript"
      th:src="@{/webjars/alpinejs/dist/cdn.min.js}"
      defer
    ></script>

    <!-- Global Alpine Store & Components -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.store('theme', {
                darkMode: localStorage.getItem('theme') === 'dark' || 
                          (localStorage.getItem('theme') === null && window.matchMedia('(prefers-color-scheme: dark)').matches),

                init() {
                    this.updateTheme();
                    // OS theme change listener
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                        // Only switch if no theme is explicitly set in localStorage
                        if (localStorage.getItem('theme') === null) {
                            this.darkMode = e.matches;
                            this.updateTheme();
                        }
                    });
                },

                toggle() {
                    this.darkMode = !this.darkMode;
                    // When toggling, always set a value in localStorage
                    localStorage.setItem('theme', this.darkMode ? 'dark' : 'winter');
                    this.updateTheme();
                },
                
                updateTheme() {
                    // This ensures the theme is set on the HTML tag on initial load and on change
                    document.documentElement.setAttribute('data-theme', this.darkMode ? 'dark' : 'winter');
                }
            });
        });

        // Global component functions
        function dashboardApp() {
          return {
            // Dark mode logic has been moved to the Alpine 'theme' store.
            // Other global states can be initialized here.
          }
        }
    </script>
</head>
</html>
