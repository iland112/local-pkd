<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/main}"
>
  <body>
    <div layout:fragment="content">
      <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- 헤더 섹션 -->
        <div class="mb-8">
          <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-lg shadow-lg p-8 text-white">
            <div class="flex items-center justify-between">
              <div>
                <h1 class="text-4xl font-bold mb-3">
                  <i class="fas fa-shield-alt mr-3"></i>ICAO PKD Local Manager
                </h1>
                <p class="text-blue-100 text-xl mb-2">
                  ICAO Public Key Directory 로컬 평가 및 관리 시스템
                </p>
                <p class="text-blue-200 text-sm">
                  ePassport 인증서 관리 및 Passive Authentication 검증 플랫폼
                </p>
                <!-- 표준 준수 배지 -->
                <div class="flex flex-wrap gap-2 mt-4">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500 bg-opacity-30 text-blue-100">
                    <i class="fas fa-certificate mr-1"></i> ICAO Doc 9303
                  </span>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500 bg-opacity-30 text-blue-100">
                    <i class="fas fa-file-signature mr-1"></i> RFC 5652 CMS
                  </span>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500 bg-opacity-30 text-blue-100">
                    <i class="fas fa-key mr-1"></i> RFC 5280 X.509
                  </span>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500 bg-opacity-30 text-blue-100">
                    <i class="fas fa-user-circle mr-1"></i> ISO/IEC 19794-5
                  </span>
                </div>
              </div>
              <div class="text-right hidden md:block">
                <div class="text-blue-100 text-sm">
                  <i class="fas fa-calendar-alt mr-2"></i>
                  <span x-text="currentDate"></span>
                </div>
                <div class="text-blue-100 text-sm mt-1">
                  <i class="fas fa-clock mr-2"></i>
                  <span x-text="currentTime"></span>
                </div>
                <button @click="showSystemInfo()" class="mt-3 text-blue-200 hover:text-white text-xs transition-colors">
                  <i class="fas fa-info-circle mr-1"></i> 시스템 정보
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 시스템 연결 상태 -->
        <div class="mb-8">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- PostgreSQL 데이터베이스 상태 -->
            <div class="rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 p-5 border border-l-4"
                 :class="[
                    $store.theme.darkMode ? 'bg-base-100 border-gray-700' : 'bg-white border-gray-200',
                    dbConnected ? 'border-l-green-500' : 'border-l-red-500'
                 ]">
              <div class="flex items-center justify-between mb-4">
                <div class="flex-1">
                  <h3 class="text-xs font-semibold uppercase tracking-wider mb-2" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'">
                    PostgreSQL 상태
                  </h3>
                  <div class="flex items-baseline gap-2">
                    <span class="text-2xl font-bold" :class="dbConnected ? 'text-green-600' : 'text-red-600'" x-text="dbConnected ? '연결됨' : '연결 안됨'"></span>
                  </div>
                  <p class="text-xs mt-1" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'" x-text="dbMessage"></p>
                </div>
                <div class="flex-shrink-0 ml-3">
                  <i class="fas fa-database text-4xl" :class="dbConnected ? 'text-green-500' : 'text-red-500'"></i>
                </div>
              </div>
              <button
                @click="testDatabaseConnection()"
                :disabled="dbTesting"
                class="w-full px-3 py-2 rounded-md text-xs font-medium transition-colors disabled:opacity-50"
                :class="$store.theme.darkMode ? 'bg-indigo-900 text-indigo-300 border border-indigo-700 hover:bg-indigo-800' : 'bg-indigo-50 text-indigo-700 border border-indigo-200 hover:bg-indigo-100'"
              >
                <i class="fas mr-1" :class="dbTesting ? 'fa-spinner animate-spin' : 'fa-plug'"></i>
                <span x-text="dbTesting ? '테스트 중...' : '연결 테스트'"></span>
              </button>
            </div>
            <!-- LDAP 연결 상태 -->
            <div class="rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 p-5 border border-l-4"
                 :class="[
                    $store.theme.darkMode ? 'bg-base-100 border-gray-700' : 'bg-white border-gray-200',
                    $store.app.ldapStatus.connected ? 'border-l-green-500' : 'border-l-red-500'
                 ]">
              <div class="flex items-center justify-between mb-4">
                <div class="flex-1">
                  <h3 class="text-xs font-semibold uppercase tracking-wider mb-2" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'">
                    LDAP 상태
                  </h3>
                  <div class="flex items-baseline gap-2">
                    <span class="text-2xl font-bold" :class="$store.app.ldapStatus.connected ? 'text-green-600' : 'text-red-600'" x-text="$store.app.ldapStatus.connected ? '연결됨' : '연결 안됨'"></span>
                  </div>
                  <p class="text-xs mt-1" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'" x-text="$store.app.ldapStatus.message"></p>
                </div>
                <div class="flex-shrink-0 ml-3">
                  <i class="fas fa-network-wired text-4xl" :class="$store.app.ldapStatus.connected ? 'text-green-500' : 'text-red-500'"></i>
                </div>
              </div>
              <button
                @click="$store.app.testLdapConnection()"
                :disabled="$store.app.ldapTesting"
                class="w-full px-3 py-2 rounded-md text-xs font-medium transition-colors disabled:opacity-50"
                :class="$store.theme.darkMode ? 'bg-orange-900 text-orange-300 border border-orange-700 hover:bg-orange-800' : 'bg-orange-50 text-orange-700 border border-orange-200 hover:bg-orange-100'"
              >
                <i class="fas mr-1" :class="$store.app.ldapTesting ? 'fa-spinner animate-spin' : 'fa-plug'"></i>
                <span x-text="$store.app.ldapTesting ? '테스트 중...' : '연결 테스트'"></span>
              </button>
            </div>
          </div>
        </div>

        <!-- 기능별 카드 섹션 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

          <!-- PKD Upload 카드 -->
          <div class="border rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden"
               :class="$store.theme.darkMode ? 'bg-base-100 border-gray-700' : 'bg-white border-gray-200'">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-4">
              <div class="flex items-center text-white">
                <i class="fas fa-database text-3xl mr-4"></i>
                <div>
                  <h2 class="text-xl font-bold">PKD Upload</h2>
                  <p class="text-indigo-100 text-sm">인증서 파일 업로드 및 관리</p>
                </div>
              </div>
            </div>
            <div class="p-5">
              <p class="text-sm mb-4" :class="$store.theme.darkMode ? 'text-gray-300' : 'text-gray-600'">
                ICAO PKD에서 다운로드한 LDIF, Master List 파일을 업로드하고,
                CSCA/DSC/CRL 인증서를 파싱하여 검증 후 LDAP 서버에 저장합니다.
              </p>
              <ul class="text-sm space-y-2 mb-5" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'">
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  LDIF / Master List 파일 파싱
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  인증서 Trust Chain 검증
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  OpenLDAP 자동 등록
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  실시간 처리 진행 상황 (SSE)
                </li>
              </ul>
              <div class="flex flex-wrap gap-2">
                <a href="/file/upload" class="btn btn-primary btn-sm gap-2">
                  <i class="fas fa-upload"></i> 파일 업로드
                </a>
                <a href="/upload-history" class="btn btn-outline btn-sm gap-2">
                  <i class="fas fa-history"></i> 업로드 이력
                </a>
                <a href="/file/dashboard" class="btn btn-outline btn-sm gap-2">
                  <i class="fas fa-chart-bar"></i> 통계
                </a>
              </div>
            </div>
          </div>

          <!-- Passive Authentication 카드 -->
          <div class="border rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden"
               :class="$store.theme.darkMode ? 'bg-base-100 border-gray-700' : 'bg-white border-gray-200'">
            <div class="bg-gradient-to-r from-teal-500 to-cyan-600 p-4">
              <div class="flex items-center text-white">
                <i class="fas fa-passport text-3xl mr-4"></i>
                <div>
                  <h2 class="text-xl font-bold">Passive Authentication</h2>
                  <p class="text-teal-100 text-sm">ePassport 검증</p>
                </div>
              </div>
            </div>
            <div class="p-5">
              <p class="text-sm mb-4" :class="$store.theme.darkMode ? 'text-gray-300' : 'text-gray-600'">
                ePassport의 SOD(Security Object Document)와 Data Groups를 검증하여
                여권 데이터의 무결성과 발급국 서명을 확인합니다.
              </p>
              <ul class="text-sm space-y-2 mb-5" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-500'">
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  ICAO 9303 Part 11 표준 준수
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  DSC/CSCA Trust Chain 검증
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  Data Group Hash 검증
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  DG1 (MRZ) / DG2 (Face) 파싱
                </li>
              </ul>
              <div class="flex flex-wrap gap-2">
                <a href="/pa/verify" class="btn btn-primary btn-sm gap-2" style="background: linear-gradient(to right, #14b8a6, #06b6d4); border: none;">
                  <i class="fas fa-check-circle"></i> PA 검증
                </a>
                <a href="/pa/history" class="btn btn-outline btn-sm gap-2">
                  <i class="fas fa-history"></i> 검증 이력
                </a>
                <a href="/pa/dashboard" class="btn btn-outline btn-sm gap-2">
                  <i class="fas fa-chart-line"></i> 통계
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- 빠른 시작 가이드 -->
        <div class="border rounded-xl shadow-lg p-6"
             :class="$store.theme.darkMode ? 'bg-base-100 border-gray-700' : 'bg-white border-gray-200'">
          <h3 class="text-lg font-bold mb-4 flex items-center" :class="$store.theme.darkMode ? 'text-gray-100' : 'text-gray-900'">
            <i class="fas fa-rocket text-orange-500 mr-3"></i>
            빠른 시작 가이드
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- PKD Upload 가이드 -->
            <div class="p-4 rounded-lg" :class="$store.theme.darkMode ? 'bg-base-200' : 'bg-gray-50'">
              <h4 class="font-semibold mb-3" :class="$store.theme.darkMode ? 'text-gray-200' : 'text-gray-700'">
                <i class="fas fa-database text-indigo-500 mr-2"></i>PKD 인증서 업로드
              </h4>
              <ol class="text-sm space-y-2" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-600'">
                <li class="flex items-start">
                  <span class="bg-indigo-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">1</span>
                  <span>ICAO PKD에서 LDIF 또는 Master List 파일 다운로드</span>
                </li>
                <li class="flex items-start">
                  <span class="bg-indigo-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">2</span>
                  <span><a href="/file/upload" class="text-indigo-500 hover:underline">파일 업로드</a> 페이지에서 파일 선택</span>
                </li>
                <li class="flex items-start">
                  <span class="bg-indigo-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">3</span>
                  <span>자동 파싱 → 검증 → LDAP 저장 완료</span>
                </li>
              </ol>
            </div>
            <!-- PA 검증 가이드 -->
            <div class="p-4 rounded-lg" :class="$store.theme.darkMode ? 'bg-base-200' : 'bg-gray-50'">
              <h4 class="font-semibold mb-3" :class="$store.theme.darkMode ? 'text-gray-200' : 'text-gray-700'">
                <i class="fas fa-passport text-teal-500 mr-2"></i>ePassport PA 검증
              </h4>
              <ol class="text-sm space-y-2" :class="$store.theme.darkMode ? 'text-gray-400' : 'text-gray-600'">
                <li class="flex items-start">
                  <span class="bg-teal-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">1</span>
                  <span>ePassport 칩에서 SOD, DG1, DG2 등 추출</span>
                </li>
                <li class="flex items-start">
                  <span class="bg-teal-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">2</span>
                  <span><a href="/pa/verify" class="text-teal-500 hover:underline">PA 검증</a> 페이지에서 파일 업로드</span>
                </li>
                <li class="flex items-start">
                  <span class="bg-teal-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5 flex-shrink-0">3</span>
                  <span>7단계 검증 수행 → 결과 확인</span>
                </li>
              </ol>
            </div>
          </div>
        </div>

      </div>
    </div>
  </body>
</html>
