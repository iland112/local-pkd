<!DOCTYPE html>
<html
  x-data
  :data-theme="$store.theme.darkMode ? 'dark' : 'winter'"
  th:lang="|${#locale.language}-${#locale.country}|"
  xmlns:th="http://www.thymeleaf.org"
  th:fragment="layout(content)"
>
<head th:replace="~{layout/_head :: head-content}"></head>
<body x-data="dashboardApp()" x-init="$store.theme.init()">
  <!-- Skip Navigation Links for Accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-content focus:rounded-lg focus:shadow-lg">
    메인 콘텐츠로 건너뛰기
  </a>

  <!-- Sidebar -->
  <aside th:replace="~{layout/_sidebar :: sidebar-content}"></aside>

  <!-- Main Content Wrapper - Responsive to mini sidebar -->
  <div x-data="{ sidebarExpanded: localStorage.getItem('sidebarExpanded') !== 'false' }"
       x-init="
         window.addEventListener('storage', (e) => {
           if (e.key === 'sidebarExpanded') sidebarExpanded = e.newValue !== 'false';
         });
         setInterval(() => {
           sidebarExpanded = localStorage.getItem('sidebarExpanded') !== 'false';
         }, 100);
       "
       :class="sidebarExpanded ? 'lg:ps-64' : 'lg:ps-[70px]'"
       class="transition-all duration-300">
    <!-- Header with existing navigation -->
    <header th:replace="~{layout/_nav :: nav-content}"></header>

    <!-- Main Content Area -->
    <main id="main-content" class="min-h-screen bg-base-200/30" role="main">
      <!-- Page Content - passed as fragment parameter -->
      <th:block th:replace="${content}"></th:block>
    </main>

    <!-- Footer -->
    <footer th:replace="~{layout/_footer :: footer-content}"></footer>
  </div>

  <!-- Modals -->
  <div th:replace="~{layout/_modals :: modals-content}"></div>

  <!-- Scripts -->
  <div th:replace="~{layout/_scripts :: scripts-content}"></div>

  <!-- Preline Sidebar Toggle Script -->
  <script>
    // Initialize Preline UI components after DOM load
    document.addEventListener('DOMContentLoaded', function() {
      // Re-initialize Preline after Thymeleaf renders
      if (typeof HSStaticMethods !== 'undefined') {
        HSStaticMethods.autoInit();
      }
    });

    // Re-initialize on htmx swaps
    document.body.addEventListener('htmx:afterSwap', function() {
      if (typeof HSStaticMethods !== 'undefined') {
        HSStaticMethods.autoInit();
      }
    });
  </script>
</body>
</html>
