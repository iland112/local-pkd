# ============================================================================
# ARM64 Profile - Luckfox Omni3576 Deployment
# ============================================================================
# LDAP Infrastructure (External - Local System):
#   - HAProxy (Read LB): 192.168.100.10:10389
#   - OpenLDAP1 (Write Master): 192.168.100.10:389
#   - OpenLDAP2 (Read Slave): 192.168.100.101:389
# ============================================================================

spring.application.name=Local PKD Evaluation Project (ARM64)

# ===== Server Configuration =====
server.port=8081
server.address=0.0.0.0

server.tomcat.connection-timeout=300000
server.tomcat.max-connections=500
server.tomcat.threads.max=100
server.tomcat.threads.min-spare=5

spring.mvc.async.request-timeout=300000

# ===== PostgreSQL (Docker Container) =====
spring.datasource.url=jdbc:postgresql://${DB_HOST:postgres}:${DB_PORT:5432}/${DB_NAME:icao_local_pkd}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:secret}
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# HikariCP Connection Pool (ARM64 optimized - lower resources)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ===== OpenLDAP Connection (External - Local System) =====
# Legacy single connection (backward compatibility)
app.ldap.urls=ldap://${LDAP_HOST:192.168.100.10}:${LDAP_PORT:10389}
app.ldap.base=${LDAP_BASE_DN:dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.username=${LDAP_USERNAME:cn=admin,dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.password=${LDAP_PASSWORD:core}

ldap.adapter.type=unboundid

# ===== LDAP Read/Write Separation (External Infrastructure) =====
# Write: OpenLDAP1 Direct Connection (Master - PKD Upload)
app.ldap.write.enabled=${APP_LDAP_WRITE_ENABLED:true}
app.ldap.write.url=${APP_LDAP_WRITE_URL:ldap://192.168.100.10:389}
app.ldap.write.base-dn=${APP_LDAP_WRITE_BASE_DN:dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.write.username=${APP_LDAP_WRITE_USERNAME:cn=admin,dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.write.password=${APP_LDAP_WRITE_PASSWORD:core}
app.ldap.write.pool-initial-size=3
app.ldap.write.pool-max-size=10

# Read: HAProxy Load Balanced (Statistics, PA Verification)
app.ldap.read.enabled=${APP_LDAP_READ_ENABLED:true}
app.ldap.read.url=${APP_LDAP_READ_URL:ldap://192.168.100.10:10389}
app.ldap.read.base-dn=${APP_LDAP_READ_BASE_DN:dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.read.username=${APP_LDAP_READ_USERNAME:cn=admin,dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.read.password=${APP_LDAP_READ_PASSWORD:core}
app.ldap.read.pool-initial-size=2
app.ldap.read.pool-max-size=5

# ===== LDAP Storage Settings =====
app.ldap.csca-o=o=csca
app.ldap.dsc-o=o=dsc
app.ldap.ds-o=o=ds
app.ldap.crl-o=o=crl

# ===== LDAP Sync Settings =====
app.ldap.sync.enabled=true
app.ldap.sync.batch-size=50
app.ldap.sync.max-retries=3
app.ldap.sync.initial-delay-ms=1000
app.ldap.sync.scheduled-cron=0 0 0 * * *

# ===== LDAP Batch Processing (ARM64 optimized) =====
app.ldap.batch.thread-pool-size=2
app.ldap.batch.queue-capacity=500
app.ldap.batch.keep-alive-seconds=60

# DSC Trust Chain Verification
ldif.processing.trust-chain-verification.enabled=false
ldif.processing.trust-chain-verification.country-codes=KR,JP,US

# ===== File Upload Settings =====
app.upload.directory=/app/data/uploads
app.upload.temp-dir=/app/data/temp
app.upload.max-file-size=104857600

# Spring Multipart
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB

# ===== Logging (Production) =====
logging.level.root=INFO
logging.level.com.smartcoreinc.localpkd=INFO
logging.level.com.smartcoreinc.localpkd.passiveauthentication.infrastructure.web=INFO
logging.level.org.springframework.ldap=WARN
logging.level.com.unboundid.ldap=WARN

# ===== Actuator (Health Check) =====
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
