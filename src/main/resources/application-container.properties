# Container Profile - Local PKD
# 컨테이너 환경에서 사용되는 설정

spring.application.name=Local PKD Evaluation Project

server.port=8081
server.address=0.0.0.0

server.tomcat.connection-timeout=300000
server.tomcat.max-connections=1000
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

spring.mvc.async.request-timeout=300000

# ===== PostgreSQL 연결 (컨테이너 네트워크) =====
spring.datasource.url=jdbc:postgresql://${DB_HOST:host.containers.internal}:${DB_PORT:5432}/${DB_NAME:local_pkd_db}
spring.datasource.username=${DB_USERNAME:pkd_user}
spring.datasource.password=${DB_PASSWORD:pkd_password}
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# ===== OpenLDAP 연결 (컨테이너 네트워크) =====
# Legacy 단일 연결 설정 (하위 호환용)
app.ldap.urls=ldap://${LDAP_HOST:host.docker.internal}:${LDAP_PORT:389}
app.ldap.base=dc=ldap,dc=smartcoreinc,dc=com
app.ldap.username=${LDAP_USERNAME:cn=admin,dc=ldap,dc=smartcoreinc,dc=com}
app.ldap.password=${LDAP_PASSWORD:core}

ldap.adapter.type=unboundid

# ✅ LDAP Read/Write 분리 설정 (HAProxy + OpenLDAP MMR)
# Write: OpenLDAP 1 직접 연결 (PKD 업로드 시 데이터 저장)
app.ldap.write.enabled=true
app.ldap.write.url=ldap://${LDAP_WRITE_HOST:host.docker.internal}:${LDAP_WRITE_PORT:3891}
app.ldap.write.pool-initial-size=5
app.ldap.write.pool-max-size=20

# Read: HAProxy 로드밸런싱 (통계, PA 검증 등 조회)
app.ldap.read.enabled=true
app.ldap.read.url=ldap://${LDAP_READ_HOST:host.docker.internal}:${LDAP_READ_PORT:389}
app.ldap.read.pool-initial-size=3
app.ldap.read.pool-max-size=10

# ===== LDAP 저장소 설정 =====
app.ldap.csca-o=o=csca
app.ldap.dsc-o=o=dsc
app.ldap.ds-o=o=ds
app.ldap.crl-o=o=crl

# ===== LDAP 동기화 설정 =====
app.ldap.sync.enabled=true
app.ldap.sync.batch-size=100
app.ldap.sync.max-retries=3
app.ldap.sync.initial-delay-ms=1000
app.ldap.sync.scheduled-cron=0 0 0 * * *

# ===== LDAP 배치 처리 설정 =====
app.ldap.batch.thread-pool-size=4
app.ldap.batch.queue-capacity=1000
app.ldap.batch.keep-alive-seconds=60

# DSC 인증서 신뢰 체인 검증
ldif.processing.trust-chain-verification.enabled=false
ldif.processing.trust-chain-verification.country-codes=KR,JP,US

# 파일 업로드 설정 (컨테이너 볼륨)
app.upload.directory=/app/data/uploads
app.upload.temp-dir=/app/data/temp
app.upload.max-file-size=104857600

# Spring 멀티파트 설정
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB

# Logging
logging.level.com.smartcoreinc.localpkd.passiveauthentication.infrastructure.web=DEBUG
